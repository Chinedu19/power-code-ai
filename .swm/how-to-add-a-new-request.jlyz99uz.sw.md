---
id: jlyz99uz
title: How to add a new request
file_version: 1.1.3
app_version: 1.13.12
---

In the `ðŸ“„ src/web/api/service.ts` file, we have the ApiService function that exports two function `generateCode`<swm-token data-swm-token=":src/web/api/service.ts:17:3:3:`  const generateCode = async (prompt: string) =&gt; {`"/> and `generateExplanation`<swm-token data-swm-token=":src/web/extension.ts:20:2:2:`const generateExplanation = async (text: string, context?: string) =&gt; {`"/>

# `generateCode`<swm-token data-swm-token=":src/web/api/service.ts:17:3:3:`  const generateCode = async (prompt: string) =&gt; {`"/>

<br/>

`generateCode` takes a `prompt` parameter. It is used to generate code based on the provided prompt.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/web/api/service.ts
```typescript
17       const generateCode = async (prompt: string) => {
```

<br/>

# `generateExplanation`<swm-token data-swm-token=":src/web/api/service.ts:47:3:3:`  const generateExplanation = async (`"/>

<br/>

`generateExplanation` takes a `prompt` string as an argument. It makes an asynchronous HTTP POST request to the OpenAI API endpoint to generate completions based on the provided `prompt`. The response contains a text and usage information. The function returns an object with `text` and `usage` properties if they exist in the response data. If there is an error, it handles specific scenarios such as invalid API key and displays appropriate error messages.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/web/api/service.ts
```typescript
47       const generateExplanation = async (
48         prompt: string
49       ): Promise<{ text: string; usage: string } | undefined> => {
50         try {
51           const response: AxiosResponse<CreateCompletionResponse> =
52             await axiosInstance.post("https://api.openai.com/v1/completions", {
53               prompt,
54               model: "text-davinci-003",
55               max_tokens: 1000, // Adjust the number of tokens as needed
56               temperature: 0.7, // Adjust the temperature as needed
57               n: 1, // Adjust the number of suggestions as needed
58             });
59     
60           const usage = response.data.usage as unknown as string;
61           const choices = response.data.choices;
62           const text = choices[0].text?.trim();
63           if (text && usage) {
64             return { text, usage };
65           }
66         } catch (e: any) {
67           const error = e as AxiosError<ValidationError, Record<string, unknown>>;
68           if (error.response?.status === 401) {
69             await removeAPiKey();
70             showErrorMessage("Your open AI key is invalid, Insert a new one");
71             await executeCommand("powerCodeAi.updateKey");
72             return;
73           } else {
74             const errorMessage = error.response?.data?.error?.message as string;
75             showErrorMessage(errorMessage);
76             throw new Error(e);
77           }
78         }
79       };
```

<br/>

# Adding a Testing Requests

## Testing requests

We would be using `generateCode`<swm-token data-swm-token=":src/web/api/service.ts:17:3:3:`  const generateCode = async (prompt: string) =&gt; {`"/> as an example in this section

To ensure that the new request is functioning correctly, follow these steps:

1.  Open the file `src/web/api/service.ts` (see snippet from `src/web/api/service.ts`).

2.  Locate the function `generateCode` (see snippet from `src/web/api/service.ts`).

3.  Add a new test case for the new request by appending the following code snippet to the existing test cases:

    ```typescript
    describe("generateCode", () => {
      // Existing test cases...

      it("should return the generated code for the new request", async () => {
        // Test code for the new request...
      });
    });
    ```

    Replace `// Test code for the new request...` with the necessary test code to verify the functionality of the new request.

4.  Save the file and run the tests to ensure that the new request passes the test case.

    ```bash
    yarn test
    ```

    This command will execute the test suite and provide feedback on the success or failure of the tests.

5.  Review the test results to ensure that the new request is functioning as expected. If any test fails, investigate the issue and make any necessary adjustments to the code.

By following these steps, you can test the new request and ensure that it is working correctly within the codebase.

<br/>

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBcG93ZXItY29kZS1haSUzQSUzQUNoaW5lZHUxOQ==/docs/jlyz99uz).
